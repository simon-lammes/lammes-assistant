generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             Int          @id @default(autoincrement())
  firstName      String       @map("first_name")
  lastName       String       @map("last_name")
  hashedPassword String       @map("hashed_password")
  username       String       @unique
  exercises      Exercise[]   @relation("exercisesToUsers")
  experiences    Experience[] @relation("experiencesToUsers")
  notes          Note[]       @relation("notesToUsers")

  @@map("users")
}

model Note {
  id                Int       @id @default(autoincrement())
  title             String
  updatedTimestamp  DateTime  @default(now()) @map("updated_timestamp")
  creatorId         Int       @map("creator_id")
  resolvedTimestamp DateTime? @map("resolved_timestamp")
  description       String?
  startTimestamp    DateTime? @default(now()) @map("start_timestamp")
  deadlineTimestamp DateTime? @map("deadline_timestamp")
  creator           User      @relation("notesToUsers", fields: [creatorId], references: [id])

  @@map("notes")
}

model Exercise {
  id               Int          @id @default(autoincrement())
  versionTimestamp DateTime     @map("version_timestamp")
  title            String
  creatorId        Int          @map("creator_id")
  key              String       @unique
  creator          User         @relation("exercisesToUsers", fields: [creatorId], references: [id])
  experiences      Experience[] @relation("exercisesToExperiences")

  @@map("exercises")
}

model Experience {
  exerciseId           Int       @map("exercise_id")
  learnerId            Int       @map("learner_id")
  correctStreak        Int       @default(0) @map("correct_streak")
  lastStudiedTimestamp DateTime? @map("last_studied_timestamp")
  exercises            Exercise  @relation("exercisesToExperiences", fields: [exerciseId], references: [id])
  learner              User      @relation("experiencesToUsers", fields: [learnerId], references: [id])

  @@id([exerciseId, learnerId])
  @@map("experiences")
}
